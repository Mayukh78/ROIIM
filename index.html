<!-- <html>
    <head>
        <meta charset="UTF=8">
        <script src="https://hosted.paysafe.com/checkout/v2/paysafe.checkout.min.js"></script>
        
    </head>
    
    
    <body>
        <script src="./index.js"></script>
        <button onclick="checkout()"> Pay $25 </button>
    </body>
</html> -->

<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script> -->
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
        <script src="https://hosted.paysafe.com/checkout/v2/paysafe.checkout.min.js"></script>
    </head>

 
    <body>
        <div class="container-fluid">
            <!-- <form action="http://localhost:8080/token"> -->
                <label for="email">Email Id</label>
                <input type="text" id="email" class="form-control" placeholder="Email Id" aria-label="Email Id" aria-describedby="basic-addon1">
                
                <!-- </form> -->
                
                <button class="btn btn-primary" > Pay $25 </button>
            </div>
        </body>
        
        <script>
            let refNum= "ROM"+Math.floor(Math.random()*10000);
            var options={    
                "currency": "USD",
                "amount": 10000,
                "locale": "en_US",
                "customer": {
                    "firstName": "John",
                    "lastName": "Dee",
                    "email": "johndee@paysafe.com",
                    "phone": "1234567890",
                    "dateOfBirth": {
                        "day": 1,
                        "month": 7,
                        "year": 1990
                    }
                },
                "billingAddress": {
                    "nickName": "John Dee",
                    "street": "20735 Stevens Creek Blvd",
                    "street2": "Montessori",
                    "city": "Cupertino",
                    "zip": "95014",
                    "country": "US",
                    "state": "CA"
                },
                "environment": "TEST",
                // "merchantRefNum": "1559900597607",
                "merchantRefNum": refNum,
                // "singleUseCustomerToken":"C0OAYmitRFJ5Oe2",
                "canEditAmount": true,
                "merchantDescriptor": {   
                    "dynamicDescriptor": "XYZ",
                    "phone": "1234567890"
                    },
                "displayPaymentMethods":["card"],
                "paymentMethodDetails": {
                    "paysafecard": {
                        "consumerId": "1232323"
                    },
                    "paysafecash": {
                        "consumerId": "123456"
                    },
                    "sightline": {
                        "consumerId": "123456",
                        "SSN": "123456789",
                        "last4ssn": "6789",
                        "accountId":"1009688222"
                    },
                    "vippreferred":{
                        "consumerId": "550726575",
                        "accountId":"1679688456"
                    }
                }
            }
        
        $(document).ready(function(){
            $("button").click(function(event){
			  	// event.preventDefault();
			    customerToken();
			});
        });

        function customerToken()
        {
            var body={
                    "email": document.getElementById("email").value
                    };
                    $.ajax({
                        url: 'http://localhost:8080/token',
                        headers: { 
                            'Accept': 'application/json',
                            'Content-Type': 'application/json' 
                        },
                        type: 'post',
                        data: JSON.stringify(body),
                        // dataType: 'json',
                        contentType: 'application/json',
                        success: function (token) {
                            console.log("From Customer Token");
                            console.log(token);
                            if(token)
                                options["singleUseCustomerToken"]=token;
                            checkout();
                }
            });
        }

        function checkout() {
            paysafe.checkout.setup("cHVibGljLTc3NTE6Qi1xYTItMC01ZjAzMWNiZS0wLTMwMmQwMjE1MDA4OTBlZjI2MjI5NjU2M2FjY2QxY2I0YWFiNzkwMzIzZDJmZDU3MGQzMDIxNDUxMGJjZGFjZGFhNGYwM2Y1OTQ3N2VlZjEzZjJhZjVhZDEzZTMwNDQ=", 
            options,
            function(instance, error, result) {
                if (result && result.paymentHandleToken) {
                    console.log(result.paymentHandleToken);
                    console.log(result.customerOperation)
                    console.log("Instance Object below");
                    console.log(instance);
                    var data={
                        "paymentHandleToken":result.paymentHandleToken,
                        "customerOperation":result.customerOperation,
                        "merchantRefNum":refNum,
                        "amount":10000,
                        "currencyCode":"USD",
                        "email":document.getElementById("email").value
                    }
                    // make AJAX call to Payments API
                    $.ajax({
                        url: 'http://localhost:8080/payment',
                        type: 'post',
                        data: JSON.stringify( data),
                        // dataType: 'json',
                        contentType: 'application/json',
                        success: function () {
                            console.log("Succesfull");
                            instance.showSuccessScreen("Payment completed Successfully");
                            setTimeout(2000,location.reload);
            },
            
        });
                } else {
                    console.error(error);
                    // Handle the error

                }
            }, function(stage, expired) {
                switch(stage) {
                    case "PAYMENT_HANDLE_NOT_CREATED": // Handle the scenario
                    case "PAYMENT_HANDLE_CREATED": // Handle the scenario
                    case "PAYMENT_HANDLE_REDIRECT": // Handle the scenario
                    case "PAYMENT_HANDLE_PAYABLE": // Handle the scenario
                    default: // Handle the scenario
                }
            });
        }
    </script>
</html>